
基于混合部署的智能工业机器人操作系统关键技术研究
研究内容：
1. 基于国产实时操作系统的RTVM适配与优化
2. EtherCAT实时协议实时系统适配与优化
3. 跨域实时通讯设计与优化
4. 智能工业机器人的案例验证
非实时 EmbeddedEuler 
实时 uniproton

# Rust-Shyper

- MVM：管理虚拟机
- GVM：通用虚拟机

![](assets/Pasted%20image%2020251019161040.png)

## 编译

```shell
make
```

[Arm GNU Toolchain Downloads – Arm Developer](https://developer.arm.com/downloads/-/arm-gnu-toolchain-downloads)

```bash
sudo apt install libclang-dev clang

# 这个运行之后没修复错误，不知道是不是必要的
sudo apt install libc6-dev-arm64-cross gcc-aarch64-linux-gnu g++-aarch64-linux-gnu

sudo apt-get install gcc-multilib
```

## qemu

```shell
# 仅编译
make qemu

# 自动跑make qemu
make run
```

Makefile里面：
```makefile
# Path
# please make a rootfs image by yourself
DISK = vm0.img

QEMU_DISK_OPTIONS = -drive file=${DISK},if=none,format=raw,id=x0 ...
```
因此，需要手动创建一个raw格式的磁盘镜像vm0.img。


# os移植

非实时 EmbeddedEuler 

实时 uniproton
- 疑似有混合关键性部署能力，可否利用？

# EtherCAT

EtherCAT协议只规定了数据帧、On-the-Fly等机制，但没有规定具体实现（包括api）。

TODO：不同版本的EtherCAT主站的功能不同，交互也有区别（例如头文件名称不一样，函数也不一样）。得明确到时候实际测试的时候需要什么样的EtherCAT。

在实时系统里面实现EtherCAT主站。开源实现：
- SOEM：简单实现。核心源码（src目录）有6k+行代码，但加上其他杂七杂八的适配就有1w+行了。作为代码库安装。
- IgH：也叫EtherLab，十分庞大。作为内核模块安装。
这些实现都需要移植才能使用。

TODO：从什么角度考虑优化呢？
- 可能不容易继续优化hypervisor的设备io了。
- 针对实时os进行优化？
- 是否要改动EtherCAT的内部代码，比如增强一下设备交互部分的代码？

# 跨域实时通讯

跨域通讯：一个hypervisor里面的各VM互相交流。虽然交流的形式可以是网络，但由于这些VM都部署在同一个物理机上，所以底层可以使用共享内存等机制进行封装以加速交流。

Xen里面的Shared Memory (SHM) 就是在VIRTIO底下加个MMIO，让两个VM共同访问一块内存，这块内存包括相关元信息，以及一个发送队列+一个接收队列（因为是单读者单写者，因此实现为环形无锁队列很简单）。
- TODO：深入VIRTIO

RPMsg是一种核间通信协议，可以Shared Memory为传输介质。

# 模型部署

把大模型部署到GVM上，然后跨域把输出传递给实时系统。
- 大模型输入图像等环境信息，输出操作机器人的指令（或者其他中间信息？）。
- 这里感觉传输延迟不是很重要，毕竟大模型推理本身就很占时间。
- 但要尽可能优化传输对实时系统的影响。

TODO：大模型部署到GVM上为什么是合理的，可能要结合实际场景解释。
- 如果大模型的输出是关键路径的话（比如推理不出实时状态就没办法做下一帧动作），那得把模型部署到实时系统才好。
- 但是，若实时控制系统需要持续发起各种各样的控制信息，而大模型只是对部分任务提供了简单修正的话，那就对实时性要求比较低。

# 杂项


